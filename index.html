<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Optimized v86 for Windows 2000</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #screen_container {
            width: 800px;
            height: 600px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        #state_buttons {
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <h1>Optimized v86 for Windows 2000</h1>
    <p>Windows 2000のイメージファイルを読み込んでいます...</p>

    <div id="screen_container">
        <div style="white-space: pre; font: 14px monospace; line-height: 14px"></div>
        <canvas style="display: none"></canvas>
    </div>

    <div id="state_buttons">
        <button id="lock_mouse">マウスをキャプチャ</button>
        <button id="save_state">状態を保存</button>
        <button id="restore_state">状態を復元</button>
    </div>
    
    <script src="https://copy.sh/v86/libs/v86.js"></script>
    <script>
        window.onload = function() {
            // --- ここからがv86の設定です ---
            const emulator = new V86Starter({
                // 画面の解像度
                screen_container: document.getElementById("screen_container"),
                
                // --- パフォーマンス優先設定 ---
                // WebAssembly版を使用 (最も高速)
                wasm_path: "https://copy.sh/v86/build/v86.wasm", 
                
                // メモリサイズ (Windows 2000の推奨最小値に近い128MBに設定)
                // 大きすぎると逆にホストPCの負荷が高まります
                memory_size: 128 * 1024 * 1024,
                
                // VGAメモリサイズ (グラフィック用。最低限の8MB)
                vga_memory_size: 8 * 1024 * 1024, 
                
                // サウンド機能を無効化 (負荷軽減に効果あり)
                disable_speaker: true, 
                
                // ネットワーク機能を無効化 (不要であれば負荷軽減になります)
                // network_relay_url: "wss://relay.widgetry.org/", // ← ネットワークが必要な場合はこの行のコメントを外す

                // --- ここにあなたのディスクイメージを指定します ---
                // 例: cdrom: { url: "w2k.iso" },
                // 例: hda: { url: "windows2000.img", async: true, size: 4 * 1024 * 1024 * 1024 },
                
                // 下の行をあなたのWindows 2000のイメージファイルに書き換えてください
                cdrom: {
                    url: "YOUR_WINDOWS_2000_IMAGE.iso", // ★★★★★ このファイル名を変更 ★★★★★
                    async: true,
                },

                // 起動時にメッセージを非表示にする
                autostart: true,
            });

            // マウスキャプチャボタンの処理
            document.getElementById("lock_mouse").onclick = () => {
                emulator.lock_mouse();
            };

            // 状態の保存・復元ボタンの処理
            let savedState;
            document.getElementById("save_state").onclick = async () => {
                savedState = await emulator.save_state();
                console.log("状態が保存されました。");
            };
            document.getElementById("restore_state").onclick = () => {
                if (savedState) {
                    emulator.restore_state(savedState);
                    console.log("状態が復元されました。");
                } else {
                    alert("保存された状態がありません。");
                }
            };
        };
    </script>
</body>
</html>
